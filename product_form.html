{% extends "base.html" %}

{% block title %}{% if product %}Edit{% else %}Tambah{% endif %} Produk - FIFO Stock{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="mb-6">
        <h2 class="text-2xl font-bold text-gray-800">
            {% if product %}Edit Produk{% else %}Tambah Produk Baru{% endif %}
        </h2>
        <p class="text-gray-600">Kelola informasi produk</p>
    </div>

    <div class="bg-white rounded-lg shadow p-6">
        <form method="POST" action="{% if product %}{{ url_for('edit_product', id=product.id) }}{% else %}{{ url_for('add_product') }}{% endif %}">
            <div class="space-y-6">
                <!-- Product Code -->
                <div>
                    <label for="code" class="block text-sm font-medium text-gray-700 mb-1">
                        Kode Produk *
                    </label>
                    <input type="text" id="code" name="code" required
                           value="{{ product.code if product else '' }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="PRD001">
                </div>

                <!-- Product Name -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700 mb-1">
                        Nama Produk *
                    </label>
                    <input type="text" id="name" name="name" required
                           value="{{ product.name if product else '' }}"
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                           placeholder="Nama produk lengkap">
                </div>

                <!-- Unit and Min Stock -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="unit" class="block text-sm font-medium text-gray-700 mb-1">
                            Satuan
                        </label>
                        <select id="unit" name="unit"
                                class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="pcs" {% if product and product.unit == 'pcs' %}selected{% endif %}>Pcs</option>
                            <option value="kg" {% if product and product.unit == 'kg' %}selected{% endif %}>Kg</option>
                            <option value="liter" {% if product and product.unit == 'liter' %}selected{% endif %}>Liter</option>
                            <option value="meter" {% if product and product.unit == 'meter' %}selected{% endif %}>Meter</option>
                            <option value="unit" {% if product and product.unit == 'unit' %}selected{% endif %}>Unit</option>
                            <option value="pack" {% if product and product.unit == 'pack' %}selected{% endif %}>Pack</option>
                        </select>
                    </div>

                    <div>
                        <label for="min_stock" class="block text-sm font-medium text-gray-700 mb-1">
                            Stok Minimum
                        </label>
                        <input type="number" id="min_stock" name="min_stock" step="0.01"
                               value="{{ product.min_stock if product else '0' }}"
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>

                {% if product %}
                <!-- Stock Info -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-medium text-blue-800 mb-2">Informasi Stok Saat Ini</h4>
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="text-sm text-blue-600">Stok Tersedia</p>
                            <p class="text-xl font-bold">{{ "%.2f"|format(product.stock) }} {{ product.unit }}</p>
                        </div>
                        <div>
                            <p class="text-sm text-blue-600">Nilai Stok (FIFO)</p>
                            <p class="text-xl font-bold">{{ "%.2f"|format(product.get_stock_value()) }}</p>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Form Actions -->
                <div class="pt-6 border-t">
                    <div class="flex justify-end space-x-4">
                        <a href="{{ url_for('products') }}" 
                           class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50">
                            Batal
                        </a>
                        <button type="submit" 
                                class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            {% if product %}Update{% else %}Simpan{% endif %} Produk
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<script>
    // Auto generate code if empty
    document.getElementById('name').addEventListener('input', function() {
        const codeField = document.getElementById('code');
        if (!codeField.value && this.value) {
            const name = this.value.toUpperCase();
            const code = name.substring(0, 3) + Math.floor(Math.random() * 1000);
            codeField.value = code;
        }
    });
</script>
{% endblock %}
